# 3Dマインクラフト風ブラウザゲーム 要件定義書（MVP）

## 1. 背景・目的
- ブラウザ上で動作し、GitHub Pagesで公開できる3Dサンドボックスゲームの最小実装を提供する。
- 「マインクラフト」の採掘・設置・探索体験を3Dで再現し、後続の機能追加（マルチプレイやクラフト拡張）の土台を整える。

## 2. 対象ユーザー
- ブラウザで気軽に3Dクラフトを楽しみたいライトゲーマー。
- 3Dゲーム開発やレンダリング学習を兼ねた開発メンバー。

## 3. ターゲットプラットフォーム
- PCブラウザ（最新のChrome / Edge / Firefox）。WebGL2が利用可能であること。
- GitHub Pagesにホストし、HTTPS経由で配信。
- モバイル対応はMVP範囲外。

## 4. スコープ
### 4.1 MVPで提供する要素
- 単一チャンク（例：32×32×32ブロック）の立方体ワールドを自動生成。
- プレイヤーの一人称視点（FPS）での移動・ジャンプ・マウス視点操作。
- ブロック破壊（採掘）と設置（隣接ブロックのみ）。
- ホットバー型インベントリ（5スロット）とブロック切り替え。
- 環境光＋簡易ディレクショナルライト、テクスチャレンダリング。

### 4.2 MVPで対象外とする要素
- 敵やNPCなどのAI。
- 昼夜サイクル、天候、影、ボリュームフォグなど高負荷エフェクト。
- 複雑なクラフトレシピやツール耐久度。
- セーブ/ロード、マルチプレイ、ワールド拡張。
- サウンド、UIテーマ切替、設定メニュー。

## 5. ゲーム概要
- プレイヤーは一人称視点でブロック世界を探索し、採掘・設置で地形を編集する。
- ブロック種は air / grass / dirt / stone / wood / leaves を基本とする。
- 採掘したブロックはインベントリに入り、選択したブロックを設置できる。

## 6. 機能要件
### 6.1 ワールド生成
- ボクセルグリッド（1ブロック＝1m）で保持。
- 高さマップ＋シンプルノイズ（PerlinまたはSimplex）で地形を生成。地表にgrass、地下にdirtとstoneを配置。
- 一部の地表セルにwoodとleavesで簡易ツリーを生成。
- ワールドは起動ごとにリセット。シード指定や永続化は範囲外。

### 6.2 プレイヤー挙動
- WASDで移動、Spaceでジャンプ、Shiftでスニーク（移動速度低下）。
- マウス移動で視点回転（Y軸360度、上下は±85度に制限）。
- 重力・終端速度・地面判定を実装。階段状地形には1ブロックまで自動で乗り上げ可。
- カメラはプレイヤー頭部位置に配置し、クロスヘアをHUD表示。

### 6.3 ブロック操作
- クロスヘア方向にレイキャストし、最大距離5ブロックでヒットしたブロックを破壊可能。
- 破壊にチャージ時間は設けず即時破壊。破壊時にインベントリへ追加（スタックなし、1スロット1種類）。
- 設置はヒット面に隣接する空気ブロックに限定。プレイヤーと衝突する配置は不可。

### 6.4 インベントリUI
- 画面下部中央にホットバー（5スロット）を表示。
- 数字キー（1〜5）で選択切り替え、マウスホイールでも順送り。
- 選択中スロットの残数を表示。0になると自動で空スロットに戻る。

### 6.5 レンダリング
- Three.jsのPerspectiveCamera（FOV 70度、アスペクトは画面サイズに追随）。
- ブロックはテクスチャアトラスを利用したメッシュインスタンシングで描画。
- ワールド更新時のみジオメトリを再生成して描画負荷を抑制。
- 線形フォグで遠景を簡易処理。

### 6.6 UI/UX
- タイトル画面やポーズメニューは省略。ロード完了で即プレイ開始。
- 画面左上にFPS表示と操作ガイドを簡潔に表示（任意）。
- Pointer Lock APIでマウスロックを行い、Escで解除。

## 7. 非機能要件
- 技術スタック: TypeScript / Vite / Three.js / Cannon-es（必要なら）。
- パフォーマンス: フルHDで30fps以上、できれば60fps。描画ブロック数は最大32×32×32。
- ビルド: npm run build で dist/ に成果物を出力。
- 品質保証: 手動テストで移動・視点操作・ブロック破壊/設置を確認。可能ならVitestでワールド生成ロジックをテスト。

## 8. 画面仕様
- キャンバスはウィンドウ全体を使用（レスポンシブ）。
- HUD要素: クロスヘア、ホットバー、FPS表示。
- カラーテーマは自然色（芝生#5da545、土#8b5a2b、石#7c8c8d）。
- マウスロック中はカーソル非表示、解除時は操作説明をオーバーレイ表示。

## 9. 操作フロー
1. ブラウザでアクセス → ローディング完了後、自動でマウスロック要求。
2. WASDで移動し、マウスで視点操作。Spaceでジャンプ。
3. 左クリックでブロック破壊、右クリックで選択ブロック設置。
4. 数字キーまたはホイールでブロック種類を切り替え。
5. Escでマウスロック解除 → 再クリックで復帰。

## 10. 技術構成
- src/main.ts: Three.js初期化、シーン生成、ゲームループ管理。
- src/world/voxelWorld.ts: チャンクデータ生成・取得・更新。
- src/player/playerController.ts: 入力処理とプレイヤー物理。
- src/player/cameraRig.ts: カメラ制御とマウスロック制御。
- src/interaction/blockInteractor.ts: レイキャストによる破壊/設置処理。
- src/ui/hud.ts: ホットバーとFPSメーター描画。
- assets/textures/blocks.png: 16×16テクスチャアトラス。

## 11. GitHub Pages デプロイ要件
- GitHub Actionsで npm install → npm run build → dist/ を gh-pages ブランチへ配置。
- dist/index.html をエントリーポイントとし、相対パスでアセットを解決。
- SPA構成のため dist/404.html を index.html コピーで用意。
- デプロイ後にChrome/Firefoxで動作確認（Pointer Lock許可、ブロック操作、パフォーマンス）。

## 12. 今後の拡張候補
- 昼夜サイクル、太陽・月、シャドウマッピング。
- 水・溶岩ブロック、流体シミュレーション。
- エンティティ追加（動物・敵・アイテムドロップ）。
- クラフトレシピ、ツール、装備システム。
- マルチプレイ（WebRTCやSocket）とワールド永続化。

## 13. マイルストーン（目安）
1. セットアップ（1日）：Vite + Three.js環境構築、ビルド/ホットリロード確認。
2. コアシステム（3日）：ボクセル生成、メッシュ化、プレイヤー移動・視点・重力。
3. インタラクション（2日）：レイキャスト、ブロック破壊/設置、ホットバー実装。
4. 仕上げ（1日）：パフォーマンス調整、HUD、品質確認、GitHub Pagesデプロイ設定。

以上により、3Dマインクラフト風のMVPをブラウザ上で体験可能にする。
